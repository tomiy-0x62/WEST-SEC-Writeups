# Redacted

Scorer: 100

## 概要
フラグを隠して出力する実行ファイルから隠されたflagを探す問題

## 問題
redactedという実行ファイルが与えられるので、そこからflagを探し出す問題。

## 解き方
ダウンロードしたときに実行権限が与えられてないので実行権限を与える。
```
$ chmod +x redacted
```
とりあえず、実行してみる。
```
$ ./redacted
FLAG{##########
あれ?フラグを隠しちゃった!見えないよ!
```
straceしてwriteシステムコールの引数をみてみる。
```
$ strace ./redacted
〜省略〜
write(1, "FLAG{wh3n_y0u_6aze_int0_4he_aby3"..., 78FLAG{##########
) = 78
write(1, "\343\201\202\343\202\214?\343\203\225\343\203\251\343\202\260\343\202\222\351\232\240\343\201\227\343\201\241\343\202\203\343"..., 55あれ?フラグを隠しちゃった!見えないよ!
) = 55
exit_group(0)                           = ?
+++ exited with 0 +++
```
なんかflagの一部が見えてる。
writeシステムコールの仕様は`man 2 write`で確認すると、プロトタイプが`ssize_t write(int fd, const void *buf, size_t count);`
で、戻り値は成功した場合、書き込んだバイト数、第一引数は書き込み先のファイルディスクリプタ、第二引数は書き込む文字列のバッファ、第三引数は書き込むバイト数だとわかる。straceの出力を見ると、バッファが途中までしか表示されていない。

「strace 文字数」で検索すると、`-s`で出力する文字数を変更できるとわかる( https://qiita.com/yoheia/items/22f7a85ac1b426e34d4e )。
80文字まで表示できるようにしてstraceしてみると、
```

$ strace -s 80 ./redacted
write(1, "FLAG{wh3n_y0u_6aze_int0_4he_aby33_4he_4by3s_g4zes_1nt0_y0u}\33[54D\33[K##########\n", 78FLAG{wh3n_y0u_6aze_int0_4he_aby33_4he_4b
##########
) = 78
write(1, "\343\201\202\343\202\214?\343\203\225\343\203\251\343\202\260\343\202\222\351\232\240\343\201\227\343\201\241\343\202\203\343\201\243\343\201\237!\350\246\213\343\201\210\343\201\252\343\201\204\343\202\210!\n", 55あれ?フラグを隠しちゃった!見えないよ!
) = 55
exit_group(0)                           = ?
+++ exited with 0 +++

```
flagが'FLAG{wh3n_y0u_6aze_int0_4he_aby33_4he_4by3s_g4zes_1nt0_y0u}'だとわかる。

## 与えられたバイナリについて
straceの出力を見ると、writeシステムコールでflagが標準出力(fd = 1)に出力されているのに、標準出力にflagが表示されない。
これは、一度表示した文字列をANSIエスケープシーケンスを使って見えなくしているのである。
"\33[54D"が、カーソルを54左に移動、"\33[K"がカーソルの右側を消去である。
(参考: https://qiita.com/PruneMazui/items/8a023347772620025ad6)
後で気づいたが、ファイルにリダイレクトしてもflagは見える。
```
$ ./redacted > flag.txt
$ nvim flag.txt
    1 FLAG{wh3n_y0u_6aze_int0_4he_aby33_4he_4by3s_g4zes_1nt0_y0u}^[[54D^[[K##########
    2 あれ?フラグを隠しちゃった!見えないよ!
```
